<div class="employee-container">
  <!-- Header -->
  <header class="employee-header">
    <div class="header-content">
      <div class="employee-info">
        <div class="employee-avatar">
          <span>{{ employeeName.charAt(0) }}</span>
        </div>
        <div class="employee-details">
          <h1 class="employee-name">{{ employeeName }}</h1>
          <p class="employee-role">{{ position }} ‚Ä¢ {{ department }}</p>
          <span class="employee-id">ID: {{ employeeId }}</span>
        </div>
      </div>
      <div class="header-actions">
        <button class="nav-btn home" routerLink="/home">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9,22 9,12 15,12 15,22"/>
          </svg>
          Home
        </button>
        <button class="nav-btn back" (click)="goBack()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back
        </button>
      </div>
    </div>
  </header>

  <!-- Main Dashboard Content -->
  <main class="dashboard-content">
    
    <!-- Quick Stats Cards -->
    <section class="stats-section">
      <div class="stats-grid">
        
        <!-- Total Salary Card -->
        <div class="stat-card salary-card">
          <div class="card-icon">üí∞</div>
          <div class="card-content">
            <h3>Total Salary</h3>
            <div class="salary-amount">
              <span class="currency">‚Çπ</span>
              <span class="amount">{{ currentPayroll?.netSalary || 0 | number:'1.0-0' }}</span>
            </div>
            <p class="card-subtitle">{{ currentPayroll?.payPeriod || 'Current Month' }}</p>
          </div>
          <button class="card-action" (click)="openPayrollModal()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"/>
              <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
              <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
              <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"/>
              <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"/>
            </svg>
            View Details
          </button>
        </div>

        <!-- Leaves Card -->
        <div class="stat-card leaves-card" 
             [title]="getLeavesTooltip()" 
             (mouseenter)="showLeavesTooltip = true" 
             (mouseleave)="showLeavesTooltip = false">
          <div class="card-icon">üìÖ</div>
          <div class="card-content">
            <h3>Leaves Taken</h3>
            <div class="leaves-info">
              <span class="leaves-count">{{ totalLeavesTaken }}</span>
              <span class="leaves-label">days</span>
            </div>
            <p class="card-subtitle">{{ currentMonth }}</p>
          </div>
          <button class="card-action" (click)="openLeaveRequestModal()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M8 2v4"/>
              <path d="M16 2v4"/>
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            Request Leave
          </button>
          
          <!-- Enhanced Tooltip -->
          <div class="enhanced-tooltip leaves-tooltip" *ngIf="showLeavesTooltip">
            <div class="tooltip-header">
              <h4>üìÖ Leave Summary</h4>
            </div>
            <div class="tooltip-content">
              <div class="tooltip-item">
                <span class="tooltip-label">Total Leaves:</span>
                <span class="tooltip-value">{{ totalLeaves }} days</span>
              </div>
              <div class="tooltip-item">
                <span class="tooltip-label">Used Leaves:</span>
                <span class="tooltip-value">{{ usedLeaves }} days</span>
              </div>
              <div class="tooltip-item">
                <span class="tooltip-label">Remaining:</span>
                <span class="tooltip-value">{{ remainingLeaves }} days</span>
              </div>
              <div class="tooltip-item">
                <span class="tooltip-label">This Month:</span>
                <span class="tooltip-value">{{ totalLeavesTaken }} days</span>
              </div>
              <div class="tooltip-item highlight">
                <span class="tooltip-label">Status:</span>
                <span class="tooltip-value" [class]="remainingLeaves > 5 ? 'good' : remainingLeaves > 2 ? 'warning' : 'critical'">
                  {{ remainingLeaves > 5 ? 'Good' : remainingLeaves > 2 ? 'Low' : 'Critical' }}
                </span>
              </div>
            </div>
            <div class="tooltip-footer">
              <small>Click "Request Leave" to apply for new leave</small>
            </div>
          </div>
        </div>

        <!-- Work Timing Card -->
        <div class="stat-card timing-card">
          <div class="card-icon">‚è∞</div>
          <div class="card-content">
            <h3>Work Hours</h3>
            <div class="timing-info">
              <span class="hours-worked">{{ totalHoursWorked }}</span>
              <span class="hours-label">hours</span>
            </div>
            <p class="card-subtitle">{{ currentMonth }}</p>
          </div>
          <div class="timing-actions">
            <button class="punch-btn" [class.active]="canPunchIn" (click)="punchIn()" [disabled]="!canPunchIn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
              </svg>
              Punch In
            </button>
            <button class="punch-btn" [class.active]="canPunchOut" (click)="punchOut()" [disabled]="!canPunchOut">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
              </svg>
              Punch Out
            </button>
          </div>
        </div>

        <!-- Loans Card -->
        <div class="stat-card loans-card" 
             [title]="getLoansTooltip()" 
             (mouseenter)="showLoansTooltip = true" 
             (mouseleave)="showLoansTooltip = false">
          <div class="card-icon">üí≥</div>
          <div class="card-content">
            <h3>Active Loans</h3>
            <div class="loans-info">
              <span class="loan-amount">‚Çπ{{ activeLoanAmount | number:'1.0-0' }}</span>
              <span class="loan-count">{{ activeLoansCount }} loan(s)</span>
            </div>
            <p class="card-subtitle">Outstanding</p>
          </div>
          <button class="card-action" (click)="openAdvanceRequestModal()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1v6m0 0l3-3m-3 3L9 4"/>
              <path d="M12 17v6m0 0l3-3m-3 3L9 20"/>
            </svg>
            Request Advance
          </button>
          
          <!-- Enhanced Tooltip -->
          <div class="enhanced-tooltip loans-tooltip" *ngIf="showLoansTooltip">
            <div class="tooltip-header">
              <h4>üí≥ Loan Summary</h4>
            </div>
            <div class="tooltip-content">
              <div class="tooltip-item">
                <span class="tooltip-label">Active Loans:</span>
                <span class="tooltip-value">{{ activeLoansCount }} loan(s)</span>
              </div>
              <div class="tooltip-item">
                <span class="tooltip-label">Total Amount:</span>
                <span class="tooltip-value">‚Çπ{{ activeLoanAmount | number:'1.0-0' }}</span>
              </div>
              <div class="tooltip-item">
                <span class="tooltip-label">Outstanding:</span>
                <span class="tooltip-value">‚Çπ{{ outstandingAmount | number:'1.0-0' }}</span>
              </div>
              <div class="tooltip-item">
                <span class="tooltip-label">Recent Requests:</span>
                <span class="tooltip-value">{{ advanceRequests.length }} total</span>
              </div>
              <div class="tooltip-item highlight">
                <span class="tooltip-label">Status:</span>
                <span class="tooltip-value" [class]="activeLoansCount === 0 ? 'good' : activeLoansCount <= 2 ? 'warning' : 'critical'">
                  {{ activeLoansCount === 0 ? 'No Active Loans' : activeLoansCount <= 2 ? 'Manageable' : 'High Debt' }}
                </span>
              </div>
            </div>
            <div class="tooltip-footer">
              <small>Click "Request Advance" to apply for new loan</small>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- Quick Actions -->
    <section class="actions-section">
      <h2 class="section-title">Quick Actions</h2>
      <div class="actions-grid">
        <button class="action-btn primary" (click)="openPayrollModal()">
          <div class="btn-icon">üìä</div>
          <div class="btn-content">
            <h4>View Payroll</h4>
            <p>See detailed salary breakdown</p>
          </div>
        </button>
        
        <button class="action-btn secondary" (click)="downloadPayslip(currentMonth)">
          <div class="btn-icon">üìÑ</div>
          <div class="btn-content">
            <h4>Download Payslip</h4>
            <p>Get your salary slip</p>
          </div>
        </button>
        
        <button class="action-btn tertiary" (click)="generatePayroll()">
          <div class="btn-icon">üîÑ</div>
          <div class="btn-content">
            <h4>Generate Payroll</h4>
            <p>Calculate current month salary</p>
          </div>
        </button>
      </div>
    </section>

  </main>

  <!-- Payroll Details Modal -->
  <div class="modal-overlay" *ngIf="showPayrollModal" (click)="closePayrollModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Payroll Details</h2>
        <button class="close-btn" (click)="closePayrollModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="modal-body" *ngIf="currentPayroll">
        <!-- Employee Info -->
        <div class="employee-info-section">
          <div class="info-item">
            <span class="label">Employee Name:</span>
            <span class="value">{{ currentPayroll.employeeName }}</span>
          </div>
          <div class="info-item">
            <span class="label">Employee ID:</span>
            <span class="value">{{ currentPayroll.employeeId }}</span>
          </div>
          <div class="info-item">
            <span class="label">Payroll ID:</span>
            <span class="value payroll-id">{{ currentPayroll.payrollId }}</span>
            <button class="copy-btn" (click)="copyPayrollId(currentPayroll.payrollId)">üìã</button>
          </div>
          <div class="info-item">
            <span class="label">Pay Period:</span>
            <span class="value">{{ currentPayroll.payPeriod }}</span>
          </div>
        </div>

        <!-- Salary Breakdown -->
        <div class="salary-breakdown">
          <h3>Salary Breakdown</h3>
          
          <!-- Earnings -->
          <div class="breakdown-section earnings">
            <h4>üí∞ Earnings</h4>
            <div class="breakdown-item">
              <span class="label">Basic Salary</span>
              <span class="amount">‚Çπ{{ currentPayroll.basicSalary | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item">
              <span class="label">Allowances</span>
              <span class="amount">‚Çπ{{ currentPayroll.allowances | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item">
              <span class="label">Overtime</span>
              <span class="amount">‚Çπ{{ currentPayroll.overtime | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item">
              <span class="label">Bonus</span>
              <span class="amount">‚Çπ{{ currentPayroll.bonus | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item total">
              <span class="label">Total Earnings</span>
              <span class="amount">‚Çπ{{ currentPayroll.totalEarnings | number:'1.0-0' }}</span>
            </div>
          </div>

          <!-- Deductions -->
          <div class="breakdown-section deductions">
            <h4>üìâ Deductions</h4>
            <div class="breakdown-item">
              <span class="label">Tax</span>
              <span class="amount">-‚Çπ{{ currentPayroll.taxDeduction | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item">
              <span class="label">Insurance</span>
              <span class="amount">-‚Çπ{{ currentPayroll.insuranceDeduction | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item">
              <span class="label">Loan Deduction</span>
              <span class="amount">-‚Çπ{{ currentPayroll.loanDeduction | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item" *ngIf="currentPayroll.attendanceDeduction > 0">
              <span class="label">Attendance Deduction</span>
              <span class="amount">-‚Çπ{{ currentPayroll.attendanceDeduction | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item" *ngIf="currentPayroll.leaveDeduction > 0">
              <span class="label">Leave Deduction</span>
              <span class="amount">-‚Çπ{{ currentPayroll.leaveDeduction | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item">
              <span class="label">Other Deductions</span>
              <span class="amount">-‚Çπ{{ currentPayroll.otherDeductions | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-item total">
              <span class="label">Total Deductions</span>
              <span class="amount">-‚Çπ{{ currentPayroll.totalDeductions | number:'1.0-0' }}</span>
            </div>
          </div>

          <!-- Net Salary -->
          <div class="net-salary-section">
            <div class="net-salary-item">
              <span class="label">Net Salary After All Deductions</span>
              <span class="amount final">‚Çπ{{ currentPayroll.netSalary | number:'1.0-0' }}</span>
            </div>
          </div>
        </div>

        <!-- Payment Info -->
        <div class="payment-info">
          <h3>Payment Information</h3>
          <div class="info-item">
            <span class="label">Status:</span>
            <span class="value status" [class]="currentPayroll.status.toLowerCase()">{{ currentPayroll.status }}</span>
          </div>
          <div class="info-item">
            <span class="label">Payment Method:</span>
            <span class="value">{{ currentPayroll.paymentMethod }}</span>
          </div>
          <div class="info-item">
            <span class="label">Pay Date:</span>
            <span class="value">{{ currentPayroll.payDate }}</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closePayrollModal()">Close</button>
        <button class="btn-primary" (click)="downloadPayslip(currentMonth)">Download Payslip</button>
      </div>
    </div>
  </div>

  <!-- Leave Request Modal -->
  <div class="modal-overlay" *ngIf="showLeaveModal" (click)="closeLeaveRequestModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Request Leave</h2>
        <button class="close-btn" (click)="closeLeaveRequestModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="modal-body">
        <form (ngSubmit)="submitLeaveRequest()" #leaveForm="ngForm">
          <div class="form-group">
            <label for="leaveType">Leave Type</label>
            <select id="leaveType" name="leaveType" [(ngModel)]="leaveRequest.leaveType" required>
              <option value="">Select Leave Type</option>
              <option value="SICK">Sick Leave</option>
              <option value="PERSONAL">Personal Leave</option>
              <option value="VACATION">Vacation</option>
              <option value="EMERGENCY">Emergency</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="startDate">Start Date</label>
            <input type="date" id="startDate" name="startDate" [(ngModel)]="leaveRequest.startDate" required>
          </div>
          
          <div class="form-group">
            <label for="endDate">End Date</label>
            <input type="date" id="endDate" name="endDate" [(ngModel)]="leaveRequest.endDate" required>
          </div>
          
          <div class="form-group">
            <label for="reason">Reason</label>
            <textarea id="reason" name="reason" [(ngModel)]="leaveRequest.reason" rows="3" required></textarea>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn-secondary" (click)="closeLeaveRequestModal()">Cancel</button>
            <button type="submit" class="btn-primary" [disabled]="isSubmittingLeave">
              {{ isSubmittingLeave ? 'Submitting...' : 'Submit Request' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Advance Request Modal -->
  <div class="modal-overlay" *ngIf="showAdvanceModal" (click)="closeAdvanceRequestModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Request Advance</h2>
        <button class="close-btn" (click)="closeAdvanceRequestModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="modal-body">
        <form (ngSubmit)="submitAdvanceRequest()" #advanceForm="ngForm">
          <div class="form-group">
            <label for="amount">Amount Requested</label>
            <input type="number" id="amount" name="amount" [(ngModel)]="advanceRequest.requestAmount" required min="1000">
          </div>
          
          <div class="form-group">
            <label for="reason">Reason</label>
            <textarea id="reason" name="reason" [(ngModel)]="advanceRequest.reason" rows="3" required></textarea>
          </div>
          
          <div class="form-group">
            <label for="repaymentPlan">Repayment Plan</label>
            <select id="repaymentPlan" name="repaymentPlan" [(ngModel)]="advanceRequest.repaymentPlan" required>
              <option value="">Select Plan</option>
              <option value="1_MONTH">1 Month</option>
              <option value="2_MONTHS">2 Months</option>
              <option value="3_MONTHS">3 Months</option>
              <option value="6_MONTHS">6 Months</option>
            </select>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn-secondary" (click)="closeAdvanceRequestModal()">Cancel</button>
            <button type="submit" class="btn-primary" [disabled]="isSubmittingAdvance">
              {{ isSubmittingAdvance ? 'Submitting...' : 'Submit Request' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

</div>