<header class="page-header">
  <div class="header-content">
    <div class="header-left">
      <h1 class="page-title">üí∞ Enhanced Deduction Management System</h1>
      <p class="page-subtitle">Manage employee deductions, taxes, and payroll calculations</p>
    </div>
    <div class="header-right">
      <div class="nav-buttons">
        <button class="nav-btn home" routerLink="/home">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9,22 9,12 15,12 15,22"/>
          </svg>
          Home
        </button>
        <button class="nav-btn back" (click)="goBack()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back
        </button>
      </div>
      <div class="user-info">
        <div class="user-avatar">{{ currentUser?.name?.charAt(0) || 'A' }}</div>
        <div class="user-details">
          <span class="user-name">{{ currentUser?.name || 'Admin User' }}</span>
          <span class="user-role">{{ currentUser?.role?.toUpperCase() || 'ADMINISTRATOR' }}</span>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16,17 21,12 16,7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        Logout
      </button>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="main-content">
  <!-- Stats Cards -->
  <section class="stats-section">
    <div class="stats-grid">
      <div class="stat-card" data-aos="fade-up" data-aos-delay="100">
        <div class="stat-icon total-deductions-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
            <line x1="8" y1="21" x2="16" y2="21"/>
            <line x1="12" y1="17" x2="12" y2="21"/>
          </svg>
          <div class="icon-bg"></div>
        </div>
        <div class="stat-content">
          <h3 class="stat-number counter">‚Çπ{{ getTotalDeductionsK() }}K</h3>
          <p class="stat-label">Total Deductions</p>
          <div class="stat-trend positive">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23,6 13.5,15.5 8.5,10.5 1,18"/>
              <polyline points="17,6 23,6 23,12"/>
            </svg>
            <span>+15% this month</span>
          </div>
        </div>
      </div>
      
      <div class="stat-card" data-aos="fade-up" data-aos-delay="200">
        <div class="stat-icon tax-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <div class="icon-bg"></div>
        </div>
        <div class="stat-content">
          <h3 class="stat-number counter">‚Çπ{{ getTotalTaxK() }}K</h3>
          <p class="stat-label">Total Tax</p>
          <div class="stat-trend positive">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23,6 13.5,15.5 8.5,10.5 1,18"/>
              <polyline points="17,6 23,6 23,12"/>
            </svg>
            <span>+8% from last month</span>
          </div>
        </div>
      </div>
      
      <div class="stat-card" data-aos="fade-up" data-aos-delay="300">
        <div class="stat-icon pf-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          <div class="icon-bg"></div>
        </div>
        <div class="stat-content">
          <h3 class="stat-number counter">‚Çπ{{ getTotalPFK() }}K</h3>
          <p class="stat-label">Provident Fund</p>
          <div class="stat-trend positive">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23,6 13.5,15.5 8.5,10.5 1,18"/>
              <polyline points="17,6 23,6 23,12"/>
            </svg>
            <span>+12% this quarter</span>
          </div>
        </div>
      </div>
      
      <div class="stat-card" data-aos="fade-up" data-aos-delay="400">
        <div class="stat-icon pending-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12,6 12,12 16,14"/>
          </svg>
          <div class="icon-bg"></div>
        </div>
        <div class="stat-content">
          <h3 class="stat-number counter">{{ getPendingCount() }}</h3>
          <p class="stat-label">Pending Approvals</p>
          <div class="stat-trend neutral">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            <span>Awaiting review</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Analytics Dashboard -->
  <section class="analytics-section">
    <div class="analytics-header">
      <h2 class="analytics-title">üìä Deduction Analytics</h2>
      <p class="analytics-subtitle">Comprehensive insights into deduction patterns and trends</p>
    </div>
    
    <div class="charts-grid">
      <!-- Status Distribution Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Status Distribution</h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12,6 12,12 16,14"/>
          </svg>
        </div>
        <div class="chart-content">
          <div class="pie-chart">
            <div class="pie-slice" *ngFor="let status of getDeductionByStatus()" 
                 [style.--percentage]="(status.count / deductions.length) * 100 + '%'"
                 [style.--color]="status.color">
              <div class="slice-fill"></div>
            </div>
          </div>
          <div class="chart-legend">
            <div class="legend-item" *ngFor="let status of getDeductionByStatus()">
              <div class="legend-color" [style.background-color]="status.color"></div>
              <span class="legend-label">{{ status.status }}</span>
              <span class="legend-value">{{ status.count }} ({{ (status.count / deductions.length) * 100 | number:'1.0-1' }}%)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Department Distribution Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Department Distribution</h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9,22 9,12 15,12 15,22"/>
          </svg>
        </div>
        <div class="chart-content">
          <div class="bar-chart">
            <div class="bar-item" *ngFor="let dept of getDeductionByDepartment()">
              <div class="bar-label">{{ dept.department }}</div>
              <div class="bar-container">
                <div class="bar-fill" [style.width.%]="(dept.count / deductions.length) * 100"></div>
                <span class="bar-value">{{ dept.count }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Deductions -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Top Deductions</h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 12l2 2 4-4"/>
            <circle cx="12" cy="12" r="10"/>
          </svg>
        </div>
        <div class="chart-content">
          <div class="top-deductions">
            <div class="deduction-item" *ngFor="let deduction of getTopDeductions(); let i = index">
              <div class="deduction-rank">{{ i + 1 }}</div>
              <div class="deduction-avatar">
                <img [src]="deduction.employeePhoto" [alt]="deduction.employeeName" class="deduction-photo"
                     (error)="handleImageError($event)">
                <div class="deduction-fallback" style="display: none;">{{ deduction.employeeName.charAt(0) }}</div>
              </div>
              <div class="deduction-info">
                <div class="deduction-name">{{ deduction.employeeName }}</div>
                <div class="deduction-department">{{ deduction.department }}</div>
              </div>
              <div class="deduction-amount">
                <span class="amount-value">‚Çπ{{ deduction.totalDeduction | number }}</span>
                <span class="amount-status" 
                      [class.pending]="deduction.status === 'Pending'"
                      [class.approved]="deduction.status === 'Approved'"
                      [class.rejected]="deduction.status === 'Rejected'">
                  {{ deduction.status }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Average Deduction by Department -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Average Deduction by Department</h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
            <line x1="8" y1="21" x2="16" y2="21"/>
            <line x1="12" y1="17" x2="12" y2="21"/>
          </svg>
        </div>
        <div class="chart-content">
          <div class="average-chart">
            <div class="average-item" *ngFor="let avg of getAverageDeductionByDepartment()">
              <div class="average-label">{{ avg.department }}</div>
              <div class="average-bar">
                <div class="average-fill" 
                     [style.width.%]="(avg.averageDeduction / getMaxAverageDeduction()) * 100"></div>
              </div>
              <div class="average-value">‚Çπ{{ avg.averageDeduction | number }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Deduction Management -->
  <section class="deduction-section">
    <div class="section-header">
      <h2 class="section-title">Deduction Records</h2>
      <button class="add-btn" (click)="addDeduction()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        Add Deduction
      </button>
    </div>

    <!-- Search and Filter Controls -->
    <div class="controls-section">
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
          </svg>
          <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            placeholder="Search deductions by employee, department, or ID..."
            class="search-input"
          >
          <div class="search-glow"></div>
        </div>
      </div>
      
      <div class="filter-controls">
        <div class="filter-group">
          <label>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            Month
          </label>
          <select [(ngModel)]="selectedMonth" class="filter-select">
            <option *ngFor="let month of months" [value]="month">{{ month }}</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            Year
          </label>
          <select [(ngModel)]="selectedYear" class="filter-select">
            <option *ngFor="let year of years" [value]="year">{{ year }}</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12,6 12,12 16,14"/>
            </svg>
            Status
          </label>
          <select [(ngModel)]="selectedStatus" class="filter-select">
            <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
              <polyline points="9,22 9,12 15,12 15,22"/>
            </svg>
            Department
          </label>
          <select [(ngModel)]="selectedDepartment" class="filter-select">
            <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
          </select>
        </div>
        
        <button class="clear-btn" (click)="clearFilters()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Clear Filters
        </button>
      </div>
      
      <!-- Results Info -->
      <div class="results-info" *ngIf="searchTerm || selectedMonth !== 'All' || selectedYear !== 'All' || selectedStatus !== 'All' || selectedDepartment !== 'All'">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35"/>
        </svg>
        <span>Showing {{ filteredDeductions.length }} of {{ deductions.length }} deductions</span>
      </div>
    </div>

    <div class="table-container">
      <table class="deduction-table">
    <thead>
      <tr>
            <th (click)="sortDeductions('id')" class="sortable">
              Deduction ID
              <svg *ngIf="sortBy === 'id'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path *ngIf="sortOrder === 'asc'" d="M12 5l-7 7h14l-7-7z"/>
                <path *ngIf="sortOrder === 'desc'" d="M12 19l7-7H5l7 7z"/>
              </svg>
            </th>
            <th (click)="sortDeductions('employeeName')" class="sortable">
              Employee
              <svg *ngIf="sortBy === 'employeeName'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path *ngIf="sortOrder === 'asc'" d="M12 5l-7 7h14l-7-7z"/>
                <path *ngIf="sortOrder === 'desc'" d="M12 19l7-7H5l7 7z"/>
              </svg>
            </th>
            <th (click)="sortDeductions('department')" class="sortable">
              Department
              <svg *ngIf="sortBy === 'department'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path *ngIf="sortOrder === 'asc'" d="M12 5l-7 7h14l-7-7z"/>
                <path *ngIf="sortOrder === 'desc'" d="M12 19l7-7H5l7 7z"/>
              </svg>
            </th>
            <th>Period</th>
            <th (click)="sortDeductions('tax')" class="sortable">
              Tax
              <svg *ngIf="sortBy === 'tax'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path *ngIf="sortOrder === 'asc'" d="M12 5l-7 7h14l-7-7z"/>
                <path *ngIf="sortOrder === 'desc'" d="M12 19l7-7H5l7 7z"/>
              </svg>
            </th>
            <th (click)="sortDeductions('pf')" class="sortable">
              PF
              <svg *ngIf="sortBy === 'pf'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path *ngIf="sortOrder === 'asc'" d="M12 5l-7 7h14l-7-7z"/>
                <path *ngIf="sortOrder === 'desc'" d="M12 19l7-7H5l7 7z"/>
              </svg>
            </th>
            <th>ESI</th>
            <th>Loans</th>
            <th (click)="sortDeductions('totalDeduction')" class="sortable">
              Total Deduction
              <svg *ngIf="sortBy === 'totalDeduction'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path *ngIf="sortOrder === 'asc'" d="M12 5l-7 7h14l-7-7z"/>
                <path *ngIf="sortOrder === 'desc'" d="M12 19l7-7H5l7 7z"/>
              </svg>
            </th>
            <th (click)="sortDeductions('status')" class="sortable">
              Status
              <svg *ngIf="sortBy === 'status'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path *ngIf="sortOrder === 'asc'" d="M12 5l-7 7h14l-7-7z"/>
                <path *ngIf="sortOrder === 'desc'" d="M12 19l7-7H5l7 7z"/>
              </svg>
            </th>
            <th>Actions</th>
      </tr>
    </thead>
    <tbody>
          <tr *ngFor="let ded of filteredDeductions">
            <td class="ded-id">{{ ded.id }}</td>
            <td class="ded-employee">
              <div class="employee-cell">
                <div class="avatar">
                  <img [src]="ded.employeePhoto" [alt]="ded.employeeName" class="employee-photo" 
                       (error)="handleImageError($event)">
                  <div class="avatar-fallback" style="display: none;">{{ ded.employeeName.charAt(0) }}</div>
                </div>
                <div class="employee-info">
                  <span class="employee-name">{{ ded.employeeName }}</span>
                  <span class="employee-id">{{ ded.employeeId }}</span>
                </div>
              </div>
            </td>
            <td>{{ ded.department }}</td>
            <td class="period">{{ ded.month }} {{ ded.year }}</td>
            <td class="amount">‚Çπ{{ ded.tax | number }}</td>
            <td class="amount">‚Çπ{{ ded.pf | number }}</td>
            <td class="amount">‚Çπ{{ ded.esi | number }}</td>
            <td class="amount">‚Çπ{{ (ded.loanDeduction + ded.advanceDeduction) | number }}</td>
            <td class="total-amount">‚Çπ{{ ded.totalDeduction | number }}</td>
            <td>
              <span class="status-badge" 
                    [class.pending]="ded.status === 'Pending'" 
                    [class.approved]="ded.status === 'Approved'" 
                    [class.rejected]="ded.status === 'Rejected'">
                {{ ded.status }}
              </span>
            </td>
            <td class="actions">
              <button class="action-btn view" (click)="viewDeduction(ded)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                View
              </button>
              <button class="action-btn edit" (click)="editDeduction(ded)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
                Edit
              </button>
              <button *ngIf="ded.status === 'Pending'" class="action-btn approve" (click)="approveDeduction(ded)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4"/>
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                Approve
              </button>
              <button *ngIf="ded.status === 'Pending'" class="action-btn reject" (click)="rejectDeduction(ded)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
                Reject
              </button>
              <button class="action-btn delete" (click)="deleteDeduction(ded)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3,6 5,6 21,6"/>
                  <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                </svg>
                Delete
              </button>
            </td>
      </tr>
    </tbody>
  </table>
    </div>
  </section>
</main>

<footer class="footer glass">
  <p>¬© 2025 PayGenie. All rights reserved.</p>
</footer>

<!-- Deduction Detail Modal -->
<div class="modal-overlay" *ngIf="selectedDeduction" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Deduction Details</h3>
      <button class="modal-close" (click)="closeModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="selectedDeduction">
      <div class="deduction-profile">
        <div class="profile-avatar">
          <img [src]="selectedDeduction.employeePhoto" [alt]="selectedDeduction.employeeName" class="profile-photo"
               (error)="handleImageError($event)">
          <div class="profile-fallback" style="display: none;">{{ selectedDeduction.employeeName.charAt(0) }}</div>
        </div>
        <div class="profile-info">
          <h2 class="profile-name">{{ selectedDeduction.employeeName }}</h2>
          <p class="profile-department">{{ selectedDeduction.department }} ‚Ä¢ {{ selectedDeduction.employeeId }}</p>
          <p class="profile-period">{{ selectedDeduction.month }} {{ selectedDeduction.year }}</p>
          <div class="profile-metrics">
            <div class="metric">
              <span class="metric-label">Gross Salary</span>
              <span class="metric-value">‚Çπ{{ selectedDeduction.grossSalary | number }}</span>
            </div>
            <div class="metric">
              <span class="metric-label">Total Deduction</span>
              <span class="metric-value">‚Çπ{{ selectedDeduction.totalDeduction | number }}</span>
            </div>
            <div class="metric">
              <span class="metric-label">Net Salary</span>
              <span class="metric-value">‚Çπ{{ selectedDeduction.netSalary | number }}</span>
            </div>
          </div>
        </div>
        <div class="profile-status">
          <span class="status-badge" 
                [class.pending]="selectedDeduction.status === 'Pending'" 
                [class.approved]="selectedDeduction.status === 'Approved'" 
                [class.rejected]="selectedDeduction.status === 'Rejected'">
            {{ selectedDeduction.status }}
          </span>
        </div>
      </div>
      
      <div class="deduction-details-grid">
        <div class="detail-card">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Income Tax</h4>
            <p>‚Çπ{{ selectedDeduction.tax | number }}</p>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Provident Fund</h4>
            <p>‚Çπ{{ selectedDeduction.pf | number }}</p>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"/>
              <circle cx="12" cy="12" r="10"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>ESI</h4>
            <p>‚Çπ{{ selectedDeduction.esi | number }}</p>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
              <line x1="8" y1="21" x2="16" y2="21"/>
              <line x1="12" y1="17" x2="12" y2="21"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Professional Tax</h4>
            <p>‚Çπ{{ selectedDeduction.professionalTax | number }}</p>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1v6m0 0L9 4m3 3l3-3"/>
              <path d="M12 7v14"/>
              <path d="M17 14l-5 5-5-5"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Loan Deduction</h4>
            <p>‚Çπ{{ selectedDeduction.loanDeduction | number }}</p>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1v6m0 0L9 4m3 3l3-3"/>
              <path d="M12 7v14"/>
              <path d="M17 14l-5 5-5-5"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Advance Deduction</h4>
            <p>‚Çπ{{ selectedDeduction.advanceDeduction | number }}</p>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v6m0 6v6"/>
              <path d="M21 12h-6m-6 0H3"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Other Deductions</h4>
            <p>‚Çπ{{ selectedDeduction.other | number }}</p>
          </div>
        </div>
        
        <div class="detail-card">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Created Date</h4>
            <p>{{ selectedDeduction.createdAt }}</p>
          </div>
        </div>
        
        <div class="detail-card" *ngIf="selectedDeduction.approvedBy">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"/>
              <circle cx="12" cy="12" r="10"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Approved By</h4>
            <p>{{ selectedDeduction.approvedBy }}</p>
          </div>
        </div>
        
        <div class="detail-card notes-card" *ngIf="selectedDeduction.notes">
          <div class="detail-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
          </div>
          <div class="detail-content">
            <h4>Notes</h4>
            <p>{{ selectedDeduction.notes }}</p>
          </div>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="modal-btn edit" (click)="editDeduction(selectedDeduction); closeModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          Edit Deduction
        </button>
        <button *ngIf="selectedDeduction.status === 'Pending'" class="modal-btn approve" (click)="approveDeduction(selectedDeduction); closeModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 12l2 2 4-4"/>
            <circle cx="12" cy="12" r="10"/>
          </svg>
          Approve Deduction
        </button>
        <button *ngIf="selectedDeduction.status === 'Pending'" class="modal-btn reject" (click)="rejectDeduction(selectedDeduction); closeModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Reject Deduction
        </button>
        <button class="modal-btn delete" (click)="deleteDeduction(selectedDeduction); closeModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3,6 5,6 21,6"/>
            <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
          </svg>
          Delete Deduction
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Deduction Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-content edit-modal" (click)="$event.stopPropagation()" *ngIf="editingDeduction">
    <div class="modal-header">
      <h3 class="modal-title">‚úèÔ∏è Edit Deduction Record</h3>
      <button class="modal-close" (click)="closeEditModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="modal-body">
      <form class="edit-form" (ngSubmit)="submitEditDeduction()">
        <div class="form-section">
          <h4>üë§ Employee Information</h4>
          <div class="form-grid">
            <div class="form-group">
        <label for="employeeName">Employee Name</label>
              <input 
                type="text" 
                id="employeeName" 
                [(ngModel)]="editingDeduction.employeeName" 
                name="employeeName"
                readonly
                class="form-input readonly">
      </div>
            <div class="form-group">
        <label for="employeeId">Employee ID</label>
              <input 
                type="text" 
                id="employeeId" 
                [(ngModel)]="editingDeduction.employeeId" 
                name="employeeId"
                readonly
                class="form-input readonly">
      </div>
            <div class="form-group">
        <label for="department">Department</label>
              <select 
                id="department" 
                [(ngModel)]="editingDeduction.department" 
                name="department"
                class="form-select">
                <option value="Engineering">Engineering</option>
                <option value="Design">Design</option>
                <option value="Human Resources">Human Resources</option>
                <option value="Marketing">Marketing</option>
                <option value="Sales">Sales</option>
                <option value="Operations">Operations</option>
                <option value="Administration">Administration</option>
        </select>
      </div>
    </div>
  </div>

        <div class="form-section">
    <h4>üìÖ Period Information</h4>
          <div class="form-grid">
            <div class="form-group">
        <label for="month">Month</label>
              <select 
                id="month" 
                [(ngModel)]="editingDeduction.month" 
                name="month"
                class="form-select">
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
        </select>
      </div>
            <div class="form-group">
        <label for="year">Year</label>
              <input 
                type="number" 
                id="year" 
                [(ngModel)]="editingDeduction.year" 
                name="year"
                min="2020"
                max="2030"
                class="form-input">
      </div>
            <div class="form-group">
        <label for="status">Status</label>
              <select 
                id="status" 
                [(ngModel)]="editingDeduction.status" 
                name="status"
                class="form-select">
                <option value="Pending">Pending</option>
                <option value="Approved">Approved</option>
                <option value="Rejected">Rejected</option>
        </select>
      </div>
    </div>
  </div>

        <div class="form-section">
    <h4>üí∞ Deduction Details</h4>
          <div class="form-grid">
            <div class="form-group">
        <label for="tax">Tax Deduction</label>
              <input 
                type="number" 
                id="tax" 
                [(ngModel)]="editingDeduction.tax" 
                name="tax"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
            <div class="form-group">
        <label for="pf">Provident Fund</label>
              <input 
                type="number" 
                id="pf" 
                [(ngModel)]="editingDeduction.pf" 
                name="pf"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
            <div class="form-group">
        <label for="esi">ESI</label>
              <input 
                type="number" 
                id="esi" 
                [(ngModel)]="editingDeduction.esi" 
                name="esi"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
            <div class="form-group">
              <label for="professionalTax">Professional Tax</label>
              <input 
                type="number" 
                id="professionalTax" 
                [(ngModel)]="editingDeduction.professionalTax" 
                name="professionalTax"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
            <div class="form-group">
              <label for="loanDeduction">Loan Deduction</label>
              <input 
                type="number" 
                id="loanDeduction" 
                [(ngModel)]="editingDeduction.loanDeduction" 
                name="loanDeduction"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
            <div class="form-group">
              <label for="advanceDeduction">Advance Deduction</label>
              <input 
                type="number" 
                id="advanceDeduction" 
                [(ngModel)]="editingDeduction.advanceDeduction" 
                name="advanceDeduction"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
            <div class="form-group">
        <label for="other">Other Deductions</label>
              <input 
                type="number" 
                id="other" 
                [(ngModel)]="editingDeduction.other" 
                name="other"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
    </div>
  </div>

        <div class="form-section">
    <h4>üíµ Salary Information</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="grossSalary">Gross Salary</label>
              <input 
                type="number" 
                id="grossSalary" 
                [(ngModel)]="editingDeduction.grossSalary" 
                name="grossSalary"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
            <div class="form-group">
              <label for="netSalary">Net Salary</label>
              <input 
                type="number" 
                id="netSalary" 
                [(ngModel)]="editingDeduction.netSalary" 
                name="netSalary"
                min="0"
                class="form-input"
                (input)="onEditFieldChange()">
      </div>
            <div class="form-group">
        <label for="approvedBy">Approved By</label>
              <input 
                type="text" 
                id="approvedBy" 
                [(ngModel)]="editingDeduction.approvedBy" 
                name="approvedBy"
                placeholder="HR Manager"
                class="form-input">
      </div>
    </div>
  </div>

        <div class="form-section">
    <h4>üìù Notes</h4>
          <div class="form-group">
            <label for="notes">Additional Notes</label>
            <textarea 
              id="notes" 
              [(ngModel)]="editingDeduction.notes" 
              name="notes"
              rows="3"
              class="form-textarea"
              placeholder="Enter any additional notes about this deduction record..."></textarea>
          </div>
  </div>

        <div class="form-section">
    <h4>üìä Calculated Fields</h4>
          <div class="calculated-fields">
            <div class="calculated-item">
              <span class="calculated-label">Total Deduction:</span>
              <span class="calculated-value">‚Çπ{{ editingDeduction.totalDeduction | number:'1.2-2' }}</span>
    </div>
            <div class="calculated-item">
              <span class="calculated-label">Net Salary:</span>
              <span class="calculated-value">‚Çπ{{ editingDeduction.netSalary | number:'1.2-2' }}</span>
            </div>
          </div>
        </div>
      </form>
  </div>

    <div class="modal-footer">
      <button class="modal-btn secondary" (click)="closeEditModal()" [disabled]="isSubmittingEdit">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
        Cancel
      </button>
      <button class="modal-btn reset" (click)="resetEditForm()" [disabled]="isSubmittingEdit">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
          <path d="M3 3v5h5"/>
        </svg>
        Reset
      </button>
      <button class="modal-btn primary" (click)="submitEditDeduction()" [disabled]="isSubmittingEdit">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
        {{ isSubmittingEdit ? 'Updating...' : 'Update Record' }}
      </button>
    </div>
  </div>
</div>


<!-- Add Deduction Modal -->
<div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
  <div class="modal-content edit-modal" (click)="$event.stopPropagation()" *ngIf="newDeduction">
    <div class="modal-header">
      <h3 class="modal-title">‚ûï Add Deduction</h3>
      <button class="modal-close" (click)="closeAddModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form class="edit-form" (ngSubmit)="submitAddDeduction()">
        <div class="form-section">
          <h4>üë§ Employee Information</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="addEmployeeName">Employee Name *</label>
              <input 
                type="text" 
                id="addEmployeeName" 
                [(ngModel)]="newDeduction.employeeName" 
                name="addEmployeeName"
                required
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addEmployeeId">Employee ID *</label>
              <input 
                type="text" 
                id="addEmployeeId" 
                [(ngModel)]="newDeduction.employeeId" 
                name="addEmployeeId"
                required
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addDepartment">Department</label>
              <select 
                id="addDepartment" 
                [(ngModel)]="newDeduction.department" 
                name="addDepartment"
                class="form-select">
                <option value="Engineering">Engineering</option>
                <option value="Design">Design</option>
                <option value="Human Resources">Human Resources</option>
                <option value="Marketing">Marketing</option>
                <option value="Sales">Sales</option>
                <option value="Operations">Operations</option>
                <option value="Administration">Administration</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>üìÖ Period Information</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="addMonth">Month *</label>
              <select 
                id="addMonth" 
                [(ngModel)]="newDeduction.month" 
                name="addMonth"
                required
                class="form-select">
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
              </select>
            </div>
            <div class="form-group">
              <label for="addYear">Year *</label>
              <input 
                type="number" 
                id="addYear" 
                [(ngModel)]="newDeduction.year" 
                name="addYear"
                required
                min="2020"
                max="2030"
                class="form-input">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>üí∞ Deduction Details</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="addTax">Tax Deduction</label>
              <input 
                type="number" 
                id="addTax" 
                [(ngModel)]="newDeduction.tax" 
                (ngModelChange)="onAddFieldChange()"
                name="addTax"
                min="0"
                step="0.01"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addPf">Provident Fund</label>
              <input 
                type="number" 
                id="addPf" 
                [(ngModel)]="newDeduction.pf" 
                (ngModelChange)="onAddFieldChange()"
                name="addPf"
                min="0"
                step="0.01"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addEsi">ESI</label>
              <input 
                type="number" 
                id="addEsi" 
                [(ngModel)]="newDeduction.esi" 
                (ngModelChange)="onAddFieldChange()"
                name="addEsi"
                min="0"
                step="0.01"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addProfessionalTax">Professional Tax</label>
              <input 
                type="number" 
                id="addProfessionalTax" 
                [(ngModel)]="newDeduction.professionalTax" 
                (ngModelChange)="onAddFieldChange()"
                name="addProfessionalTax"
                min="0"
                step="0.01"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addLoanDeduction">Loan Deduction</label>
              <input 
                type="number" 
                id="addLoanDeduction" 
                [(ngModel)]="newDeduction.loanDeduction" 
                (ngModelChange)="onAddFieldChange()"
                name="addLoanDeduction"
                min="0"
                step="0.01"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addAdvanceDeduction">Advance Deduction</label>
              <input 
                type="number" 
                id="addAdvanceDeduction" 
                [(ngModel)]="newDeduction.advanceDeduction" 
                (ngModelChange)="onAddFieldChange()"
                name="addAdvanceDeduction"
                min="0"
                step="0.01"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addOther">Other Deductions</label>
              <input 
                type="number" 
                id="addOther" 
                [(ngModel)]="newDeduction.other" 
                (ngModelChange)="onAddFieldChange()"
                name="addOther"
                min="0"
                step="0.01"
                class="form-input">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>üíµ Salary Information</h4>
          <div class="form-grid">
            <div class="form-group">
              <label for="addGrossSalary">Gross Salary</label>
              <input 
                type="number" 
                id="addGrossSalary" 
                [(ngModel)]="newDeduction.grossSalary" 
                (ngModelChange)="onAddFieldChange()"
                name="addGrossSalary"
                min="0"
                step="0.01"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="addNetSalary">Net Salary</label>
              <input 
                type="number" 
                id="addNetSalary" 
                [(ngModel)]="newDeduction.netSalary" 
                (ngModelChange)="onAddFieldChange()"
                name="addNetSalary"
                min="0"
                step="0.01"
                class="form-input">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>üìù Notes</h4>
          <div class="form-group">
            <label for="addNotes">Additional Notes</label>
            <textarea 
              id="addNotes" 
              [(ngModel)]="newDeduction.notes" 
              name="addNotes"
              rows="3"
              class="form-textarea"
              placeholder="Enter any additional notes about this deduction record..."></textarea>
          </div>
        </div>

        <div class="form-section">
          <h4>üìà Calculated Fields</h4>
          <div class="calculated-fields">
            <div class="calculated-item">
              <span class="calculated-label">Total Deduction:</span>
              <span class="calculated-value">‚Çπ{{ newDeduction.totalDeduction | number:'1.2-2' }}</span>
            </div>
            <div class="calculated-item">
              <span class="calculated-label">Net Salary:</span>
              <span class="calculated-value">‚Çπ{{ (newDeduction.grossSalary || 0) - (newDeduction.totalDeduction || 0) | number:'1.2-2' }}</span>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="modal-btn secondary" (click)="closeAddModal()" [disabled]="isSubmittingAdd">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
        Cancel
      </button>
      <button class="modal-btn primary" (click)="submitAddDeduction()" [disabled]="isSubmittingAdd">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
        {{ isSubmittingAdd ? 'Creating...' : 'Create Record' }}
      </button>
    </div>
  </div>
</div>